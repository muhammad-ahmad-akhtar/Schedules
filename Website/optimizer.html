<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Schedule Optimizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .control-panel {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group h3 {
            margin-bottom: 10px;
            color: #667eea;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        select, button {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            font-size: 1rem;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        
        button.secondary {
            background: #6c757d;
        }
        
        button.success {
            background: #28a745;
        }
        
        .results-panel {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .panel-header h2 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .panel-content {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .current-schedule {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .current-schedule h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .schedule-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .schedule-item:last-child {
            border-bottom: none;
        }
        
        .alternative-slots {
            margin-top: 20px;
        }
        
        .alternative-slots h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .slot-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }
        
        .slot-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .slot-time {
            font-weight: 600;
            color: #667eea;
        }
        
        .slot-venue {
            background-color: #e9ecef;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .slot-feasibility {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .feasibility-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .feasibility-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .feasibility-high {
            background-color: #28a745;
        }
        
        .feasibility-medium {
            background-color: #ffc107;
        }
        
        .feasibility-low {
            background-color: #dc3545;
        }
        
        .slot-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        
        .slot-actions button {
            flex: 1;
            padding: 8px 12px;
            font-size: 0.9rem;
        }
        
        .recommendation-badge {
            background-color: #28a745;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .no-results {
            text-align: center;
            padding: 30px;
            color: #666;
            font-style: italic;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            border-top: 1px solid #e9ecef;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: auto;
            padding: 0;
        }
        
        .close-modal:hover {
            transform: none;
            box-shadow: none;
            opacity: 0.8;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .detail-section {
            margin-bottom: 20px;
        }
        
        .detail-section h4 {
            color: #667eea;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }
        
        .detail-label {
            font-weight: 600;
            color: #555;
        }
        
        .detail-value {
            color: #333;
        }
        
        .venue-list {
            margin-top: 10px;
        }
        
        .venue-item {
            background-color: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .feasibility-bar {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .feasibility-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .teacher-feasibility {
            background-color: #28a745;
        }
        
        .student-feasibility {
            background-color: #17a2b8;
        }
        
        .room-feasibility {
            background-color: #ffc107;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-footer button {
            width: auto;
            padding: 10px 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Timetable Optimizer</h1>
            <p class="description">Find optimal alternative time slots for your lectures considering room availability, teacher feasibility, and student batch feasibility</p>
        </header>
        
        <div class="app-container">
            <div class="control-panel">
                <div class="control-group">
                    <h3>Select Teacher</h3>
                    <select id="teacher-select">
                        <option value="">-- Select a Teacher --</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <h3>Select Course to Reschedule</h3>
                    <select id="course-select">
                        <option value="">-- Select a Course --</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <h3>Preferences</h3>
                    <select id="priority-select">
                        <option value="balanced">Balanced (All Factors)</option>
                        <option value="room">Room Availability Priority</option>
                        <option value="teacher">Teacher Convenience Priority</option>
                        <option value="students">Student Feasibility Priority</option>
                    </select>
                    
                    <button id="find-alternatives">Find Alternative Slots</button>
                </div>
                
                <div class="control-group">
                    <h3>Current Schedule</h3>
                    <div id="current-schedule-list">
                        <p class="no-results">Select a teacher to view schedule</p>
                    </div>
                </div>
            </div>
            
            <div class="results-panel">
                <div class="panel-header">
                    <h2 id="results-title">Alternative Time Slots</h2>
                    <p id="results-subtitle">Select a teacher and course to find alternatives</p>
                </div>
                
                <div class="panel-content" id="results-content">
                    <div class="no-results">
                        Please select a teacher and course, then click "Find Alternative Slots"
                    </div>
                </div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="feasibility-dot feasibility-high"></div>
                <span>High Feasibility</span>
            </div>
            <div class="legend-item">
                <div class="feasibility-dot feasibility-medium"></div>
                <span>Medium Feasibility</span>
            </div>
            <div class="legend-item">
                <div class="feasibility-dot feasibility-low"></div>
                <span>Low Feasibility</span>
            </div>
        </div>
        
        <!-- <div class="footer">
            <p>Teacher Schedule Optimizer &copy; 2023</p>
        </div> -->
    </div>

    <!-- Modal for slot details -->
    <div class="modal" id="slot-details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Alternative Slot Details</h3>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Modal content will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button class="secondary" id="close-modal-btn">Close</button>
                <button class="success" id="select-slot-btn">Select This Slot</button>
            </div>
        </div>
    </div>

    <script>
        // Faculty data from the JSON
        let facultyData = [];

        fetch('data.json')
        .then(response => {
            if (!response.ok) throw new Error('Failed to load faculty data');
            return response.json();
        })
        .then(data => {
            facultyData = data;
            init();
        })
        .catch(error => console.error('Error loading data.json:', error));

        // Time slots for the day (8:30 AM to 5:30 PM in 30-minute intervals)
        const timeSlots = [];
        for (let hour = 8; hour <= 17; hour++) {
            for (let minute = 0; minute < 60; minute += 30) {
                if (hour === 17 && minute > 0) break; // Stop at 5:30 PM
                
                const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                timeSlots.push(timeString);
            }
        }

        // Days of the week
        const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];

        // Extract all teachers from the data
        function extractTeachers(data) {
            const teachers = new Set();
            
            data.forEach(faculty => {
                teachers.add(faculty.Instructor);
            });
            
            return Array.from(teachers).sort();
        }

        // Get courses for a specific teacher
        function getTeacherCourses(data, teacher) {
            const courses = new Set();
            const teacherData = data.find(f => f.Instructor === teacher);
            
            if (!teacherData) return [];
            
            days.forEach(day => {
                if (teacherData[day] && teacherData[day].length > 0) {
                    teacherData[day].forEach(lecture => {
                        if (lecture.CourseName && lecture.CourseName !== "Unknown") {
                            courses.add(lecture.CourseName);
                        }
                    });
                }
            });
            
            return Array.from(courses).sort();
        }

        // Get current schedule for a teacher
        function getTeacherSchedule(data, teacher) {
            const schedule = [];
            const teacherData = data.find(f => f.Instructor === teacher);
            
            if (!teacherData) return [];
            
            days.forEach(day => {
                if (teacherData[day] && teacherData[day].length > 0) {
                    teacherData[day].forEach(lecture => {
                        schedule.push({
                            day: day,
                            startTime: lecture['start-time'],
                            endTime: lecture['end-time'],
                            courseName: lecture.CourseName,
                            class: lecture.Class,
                            venue: lecture.Venue,
                            type: lecture.type,
                            duration: lecture.duration
                        });
                    });
                }
            });
            
            // Sort by day and time
            const dayOrder = {
                'Monday': 1,
                'Tuesday': 2,
                'Wednesday': 3,
                'Thursday': 4,
                'Friday': 5
            };
            
            schedule.sort((a, b) => {
                if (dayOrder[a.day] !== dayOrder[b.day]) {
                    return dayOrder[a.day] - dayOrder[b.day];
                }
                
                return timeToMinutes(a.startTime) - timeToMinutes(b.startTime);
            });
            
            return schedule;
        }

        // Convert time string to minutes for comparison
        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // Format time for display
        function formatTime(timeStr) {
            const [hours, minutes] = timeStr.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        // Get all venues from the data
        function extractVenues(data) {
            const venues = new Set();
            
            data.forEach(faculty => {
                days.forEach(day => {
                    if (faculty[day] && faculty[day].length > 0) {
                        faculty[day].forEach(lecture => {
                            if (lecture.Venue && lecture.Venue !== "Unknown") {
                                venues.add(lecture.Venue);
                            }
                        });
                    }
                });
            });
            
            return Array.from(venues);
        }

        // Calculate room availability for all venues
        function calculateRoomAvailability(data) {
            const availability = {};
            const venues = extractVenues(data);
            
            // Initialize availability grid
            venues.forEach(venue => {
                availability[venue] = {};
                days.forEach(day => {
                    availability[venue][day] = {};
                    timeSlots.forEach(time => {
                        availability[venue][day][time] = true; // Initially free
                    });
                });
            });
            
            // Mark busy time slots
            data.forEach(faculty => {
                days.forEach(day => {
                    if (faculty[day] && faculty[day].length > 0) {
                        faculty[day].forEach(lecture => {
                            const venue = lecture.Venue;
                            if (!venue || venue === "Unknown") return;
                            
                            const startTime = lecture['start-time'];
                            const endTime = lecture['end-time'];
                            const startMinutes = timeToMinutes(startTime);
                            const endMinutes = timeToMinutes(endTime);
                            
                            // Mark all time slots within this class as busy
                            timeSlots.forEach(timeSlot => {
                                const slotMinutes = timeToMinutes(timeSlot);
                                const nextSlotMinutes = slotMinutes + 30;
                                
                                // Check if this time slot overlaps with the class
                                if (slotMinutes < endMinutes && nextSlotMinutes > startMinutes) {
                                    availability[venue][day][timeSlot] = false;
                                }
                            });
                        });
                    }
                });
            });
            
            return availability;
        }

        // Calculate student batch feasibility
        function calculateStudentFeasibility(data, targetClass, day, time, duration) {
            // Find all classes for the target student batch
            const classSchedule = [];
            const timeMinutes = timeToMinutes(time);
            const endMinutes = timeMinutes + (parseFloat(duration) * 60);
            
            data.forEach(faculty => {
                days.forEach(d => {
                    if (faculty[d] && faculty[d].length > 0) {
                        faculty[d].forEach(lecture => {
                            if (lecture.Class === targetClass) {
                                classSchedule.push({
                                    day: d,
                                    startTime: lecture['start-time'],
                                    endTime: lecture['end-time']
                                });
                            }
                        });
                    }
                });
            });
            
            // Check if students are free at the proposed time
            let conflictCount = 0;
            classSchedule.forEach(schedule => {
                if (schedule.day === day) {
                    const scheduleStart = timeToMinutes(schedule.startTime);
                    const scheduleEnd = timeToMinutes(schedule.endTime);
                    
                    // Check for time conflict
                    if (timeMinutes < scheduleEnd && endMinutes > scheduleStart) {
                        conflictCount++;
                    }
                }
            });
            
            // Calculate feasibility score (0-100)
            if (conflictCount > 0) {
                return 0; // Complete conflict
            }
            
            // Check if it's too close to other classes (within 30 minutes)
            let proximityPenalty = 0;
            classSchedule.forEach(schedule => {
                if (schedule.day === day) {
                    const scheduleStart = timeToMinutes(schedule.startTime);
                    const scheduleEnd = timeToMinutes(schedule.endTime);
                    
                    // Check if too close to start of another class
                    if (Math.abs(timeMinutes - scheduleEnd) < 30) {
                        proximityPenalty += 20;
                    }
                    
                    // Check if too close to end of another class
                    if (Math.abs(endMinutes - scheduleStart) < 30) {
                        proximityPenalty += 20;
                    }
                }
            });
            
            return Math.max(0, 100 - proximityPenalty);
        }

        // Calculate teacher feasibility
        function calculateTeacherFeasibility(teacherSchedule, day, time, duration) {
            const timeMinutes = timeToMinutes(time);
            const endMinutes = timeMinutes + (parseFloat(duration) * 60);
            
            // Check if teacher is free at the proposed time
            let conflictCount = 0;
            teacherSchedule.forEach(schedule => {
                if (schedule.day === day) {
                    const scheduleStart = timeToMinutes(schedule.startTime);
                    const scheduleEnd = timeToMinutes(schedule.endTime);
                    
                    // Check for time conflict
                    if (timeMinutes < scheduleEnd && endMinutes > scheduleStart) {
                        conflictCount++;
                    }
                }
            });
            
            if (conflictCount > 0) {
                return 0; // Complete conflict
            }
            
            // Check if it's too close to other classes (within 30 minutes)
            let proximityPenalty = 0;
            teacherSchedule.forEach(schedule => {
                if (schedule.day === day) {
                    const scheduleStart = timeToMinutes(schedule.startTime);
                    const scheduleEnd = timeToMinutes(schedule.endTime);
                    
                    // Check if too close to start of another class
                    if (Math.abs(timeMinutes - scheduleEnd) < 30) {
                        proximityPenalty += 20;
                    }
                    
                    // Check if too close to end of another class
                    if (Math.abs(endMinutes - scheduleStart) < 30) {
                        proximityPenalty += 20;
                    }
                }
            });
            
            return Math.max(0, 100 - proximityPenalty);
        }

        // Find alternative time slots for a course
        function findAlternativeSlots(data, teacher, course, priority) {
            const roomAvailability = calculateRoomAvailability(data);
            const teacherSchedule = getTeacherSchedule(data, teacher);
            const targetCourse = teacherSchedule.find(s => s.courseName === course);
            
            if (!targetCourse) return [];
            
            const alternatives = [];
            const duration = targetCourse.duration;
            const targetClass = targetCourse.class;
            
            // Check all possible time slots and venues
            days.forEach(day => {
                timeSlots.forEach(time => {
                    const timeMinutes = timeToMinutes(time);
                    const endMinutes = timeMinutes + (parseFloat(duration) * 60);
                    
                    // Check if this slot can accommodate the duration
                    let canAccommodate = true;
                    let checkTime = timeMinutes;
                    
                    while (checkTime < endMinutes) {
                        const checkTimeStr = `${Math.floor(checkTime / 60).toString().padStart(2, '0')}:${(checkTime % 60).toString().padStart(2, '0')}`;
                        if (!timeSlots.includes(checkTimeStr)) {
                            canAccommodate = false;
                            break;
                        }
                        checkTime += 30;
                    }
                    
                    if (!canAccommodate) return;
                    
                    // Check available venues for this time slot
                    const availableVenues = [];
                    Object.keys(roomAvailability).forEach(venue => {
                        let venueFree = true;
                        checkTime = timeMinutes;
                        
                        while (checkTime < endMinutes) {
                            const checkTimeStr = `${Math.floor(checkTime / 60).toString().padStart(2, '0')}:${(checkTime % 60).toString().padStart(2, '0')}`;
                            if (!roomAvailability[venue][day][checkTimeStr]) {
                                venueFree = false;
                                break;
                            }
                            checkTime += 30;
                        }
                        
                        if (venueFree) {
                            availableVenues.push(venue);
                        }
                    });
                    
                    if (availableVenues.length > 0) {
                        // Calculate feasibility scores
                        const teacherFeasibility = calculateTeacherFeasibility(teacherSchedule, day, time, duration);
                        const studentFeasibility = calculateStudentFeasibility(data, targetClass, day, time, duration);
                        
                        // Room feasibility is based on number of available venues
                        const roomFeasibility = Math.min(100, availableVenues.length * 20);
                        
                        // Calculate overall feasibility based on priority
                        let overallFeasibility;
                        switch (priority) {
                            case 'room':
                                overallFeasibility = roomFeasibility * 0.6 + teacherFeasibility * 0.2 + studentFeasibility * 0.2;
                                break;
                            case 'teacher':
                                overallFeasibility = teacherFeasibility * 0.6 + roomFeasibility * 0.2 + studentFeasibility * 0.2;
                                break;
                            case 'students':
                                overallFeasibility = studentFeasibility * 0.6 + roomFeasibility * 0.2 + teacherFeasibility * 0.2;
                                break;
                            default: // balanced
                                overallFeasibility = (roomFeasibility + teacherFeasibility + studentFeasibility) / 3;
                        }
                        
                        alternatives.push({
                            day: day,
                            time: time,
                            endTime: `${Math.floor(endMinutes / 60).toString().padStart(2, '0')}:${(endMinutes % 60).toString().padStart(2, '0')}`,
                            venues: availableVenues,
                            teacherFeasibility: teacherFeasibility,
                            studentFeasibility: studentFeasibility,
                            roomFeasibility: roomFeasibility,
                            overallFeasibility: overallFeasibility,
                            duration: duration,
                            class: targetClass
                        });
                    }
                });
            });
            
            // Sort by overall feasibility
            alternatives.sort((a, b) => b.overallFeasibility - a.overallFeasibility);
            
            return alternatives.slice(0, 10); // Return top 10 alternatives
        }

        // Render current schedule for a teacher
        function renderCurrentSchedule(schedule) {
            const container = document.getElementById('current-schedule-list');
            
            if (schedule.length === 0) {
                container.innerHTML = '<p class="no-results">No schedule found for this teacher</p>';
                return;
            }
            
            let html = '<div class="current-schedule">';
            
            schedule.forEach(item => {
                html += `
                    <div class="schedule-item">
                        <div>
                            <strong>${item.courseName}</strong><br>
                            <small>${item.day} • ${formatTime(item.startTime)} - ${formatTime(item.endTime)}</small>
                        </div>
                        <div>
                            <small>${item.venue} • ${item.type}</small>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Render alternative slots
        function renderAlternativeSlots(alternatives, course, teacher) {
            const resultsTitle = document.getElementById('results-title');
            const resultsSubtitle = document.getElementById('results-subtitle');
            const resultsContent = document.getElementById('results-content');
            
            if (alternatives.length === 0) {
                resultsTitle.textContent = 'No Alternatives Found';
                resultsSubtitle.textContent = 'No suitable alternative time slots found for this course';
                resultsContent.innerHTML = `
                    <div class="no-results">
                        No alternative time slots found that meet the criteria. Try adjusting your preferences.
                    </div>
                `;
                return;
            }
            
            resultsTitle.textContent = 'Alternative Time Slots';
            resultsSubtitle.textContent = `Found ${alternatives.length} alternative slot${alternatives.length !== 1 ? 's' : ''} for ${course}`;
            
            let html = `
                <div class="alternative-slots">
                    <h3>Recommended Alternatives</h3>
            `;
            
            alternatives.forEach((slot, index) => {
                const bestVenue = slot.venues[0]; // Use the first available venue
                const feasibilityLevel = slot.overallFeasibility >= 80 ? 'high' : 
                                        slot.overallFeasibility >= 50 ? 'medium' : 'low';
                
                html += `
                    <div class="slot-card">
                        <div class="slot-header">
                            <div class="slot-time">${slot.day} • ${formatTime(slot.time)} - ${formatTime(slot.endTime)}</div>
                            <div class="slot-venue">${bestVenue}</div>
                            ${index === 0 ? '<span class="recommendation-badge">BEST OPTION</span>' : ''}
                        </div>
                        
                        <div class="slot-feasibility">
                            <div class="feasibility-item">
                                <div class="feasibility-dot feasibility-${slot.teacherFeasibility >= 80 ? 'high' : slot.teacherFeasibility >= 50 ? 'medium' : 'low'}"></div>
                                <span>Teacher: ${Math.round(slot.teacherFeasibility)}%</span>
                            </div>
                            <div class="feasibility-item">
                                <div class="feasibility-dot feasibility-${slot.studentFeasibility >= 80 ? 'high' : slot.studentFeasibility >= 50 ? 'medium' : 'low'}"></div>
                                <span>Students: ${Math.round(slot.studentFeasibility)}%</span>
                            </div>
                            <div class="feasibility-item">
                                <div class="feasibility-dot feasibility-${slot.roomFeasibility >= 80 ? 'high' : slot.roomFeasibility >= 50 ? 'medium' : 'low'}"></div>
                                <span>Room: ${Math.round(slot.roomFeasibility)}%</span>
                            </div>
                        </div>
                        
                        <div class="slot-actions">
                            <button class="secondary view-details-btn" data-index="${index}">View Details</button>
                            <button class="success select-slot-btn" data-index="${index}">Select This Slot</button>
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
            resultsContent.innerHTML = html;
            
            // Add event listeners to the buttons
            document.querySelectorAll('.view-details-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    showSlotDetails(alternatives[index], course, teacher);
                });
            });
            
            document.querySelectorAll('.select-slot-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    selectSlot(alternatives[index], course, teacher);
                });
            });
        }

        // Show slot details in modal
        function showSlotDetails(slot, course, teacher) {
            const modal = document.getElementById('slot-details-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            
            modalTitle.textContent = `Alternative Slot Details - ${course}`;
            
            let html = `
                <div class="detail-section">
                    <h4>Time & Location</h4>
                    <div class="detail-item">
                        <span class="detail-label">Day:</span>
                        <span class="detail-value">${slot.day}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Time:</span>
                        <span class="detail-value">${formatTime(slot.time)} - ${formatTime(slot.endTime)}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Duration:</span>
                        <span class="detail-value">${slot.duration} hours</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Available Venues:</span>
                        <span class="detail-value">${slot.venues.length} options</span>
                    </div>
                    <div class="venue-list">
                        ${slot.venues.map(venue => `
                            <div class="venue-item">
                                <span>${venue}</span>
                                <span class="recommendation-badge">Available</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4>Feasibility Analysis</h4>
                    <div class="detail-item">
                        <span class="detail-label">Teacher Feasibility:</span>
                        <span class="detail-value">${Math.round(slot.teacherFeasibility)}%</span>
                    </div>
                    <div class="feasibility-bar">
                        <div class="feasibility-fill teacher-feasibility" style="width: ${slot.teacherFeasibility}%"></div>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Student Feasibility:</span>
                        <span class="detail-value">${Math.round(slot.studentFeasibility)}%</span>
                    </div>
                    <div class="feasibility-bar">
                        <div class="feasibility-fill student-feasibility" style="width: ${slot.studentFeasibility}%"></div>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Room Availability:</span>
                        <span class="detail-value">${Math.round(slot.roomFeasibility)}%</span>
                    </div>
                    <div class="feasibility-bar">
                        <div class="feasibility-fill room-feasibility" style="width: ${slot.roomFeasibility}%"></div>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Overall Feasibility:</span>
                        <span class="detail-value">${Math.round(slot.overallFeasibility)}%</span>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4>Impact Analysis</h4>
                    <div class="detail-item">
                        <span class="detail-label">Teacher Schedule Impact:</span>
                        <span class="detail-value">${slot.teacherFeasibility >= 80 ? 'Minimal' : slot.teacherFeasibility >= 50 ? 'Moderate' : 'Significant'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Student Schedule Impact:</span>
                        <span class="detail-value">${slot.studentFeasibility >= 80 ? 'Minimal' : slot.studentFeasibility >= 50 ? 'Moderate' : 'Significant'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Room Availability:</span>
                        <span class="detail-value">${slot.venues.length} suitable venues available</span>
                    </div>
                </div>
            `;
            
            modalBody.innerHTML = html;
            modal.style.display = 'flex';
        }

        // Select a slot (placeholder function)
        function selectSlot(slot, course, teacher) {
            alert(`Slot selected for ${course}!\n\nTeacher: ${teacher}\nTime: ${slot.day} ${formatTime(slot.time)} - ${formatTime(slot.endTime)}\nVenue: ${slot.venues[0]}\n\nThis is a demo - in a real application, this would update the schedule.`);
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('slot-details-modal');
            modal.style.display = 'none';
        }

        // Show loading state
        function showLoading() {
            const resultsContent = document.getElementById('results-content');
            resultsContent.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Finding optimal alternative time slots...</p>
                </div>
            `;
        }

        // Initialize the page
        function init() {
            const teacherSelect = document.getElementById('teacher-select');
            const courseSelect = document.getElementById('course-select');
            const findButton = document.getElementById('find-alternatives');
            const closeModalBtn = document.getElementById('close-modal');
            const closeModalBtn2 = document.getElementById('close-modal-btn');
            const selectSlotBtn = document.getElementById('select-slot-btn');
            
            // Extract teachers and populate dropdown
            const teachers = extractTeachers(facultyData);
            teachers.forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher;
                option.textContent = teacher;
                teacherSelect.appendChild(option);
            });
            
            // Handle teacher selection
            teacherSelect.addEventListener('change', function() {
                const selectedTeacher = this.value;
                
                if (selectedTeacher) {
                    // Update courses dropdown
                    const courses = getTeacherCourses(facultyData, selectedTeacher);
                    courseSelect.innerHTML = '<option value="">-- Select a Course --</option>';
                    
                    courses.forEach(course => {
                        const option = document.createElement('option');
                        option.value = course;
                        option.textContent = course;
                        courseSelect.appendChild(option);
                    });
                    
                    // Update current schedule display
                    const schedule = getTeacherSchedule(facultyData, selectedTeacher);
                    renderCurrentSchedule(schedule);
                } else {
                    courseSelect.innerHTML = '<option value="">-- Select a Course --</option>';
                    document.getElementById('current-schedule-list').innerHTML = 
                        '<p class="no-results">Select a teacher to view schedule</p>';
                }
                
                // Reset results
                document.getElementById('results-title').textContent = 'Alternative Time Slots';
                document.getElementById('results-subtitle').textContent = 'Select a teacher and course to find alternatives';
                document.getElementById('results-content').innerHTML = `
                    <div class="no-results">
                        Please select a teacher and course, then click "Find Alternative Slots"
                    </div>
                `;
            });
            
            // Handle find alternatives button
            findButton.addEventListener('click', function() {
                const selectedTeacher = teacherSelect.value;
                const selectedCourse = courseSelect.value;
                const priority = document.getElementById('priority-select').value;
                
                if (!selectedTeacher || !selectedCourse) {
                    alert('Please select both a teacher and a course');
                    return;
                }
                
                showLoading();
                
                // Simulate processing time
                setTimeout(() => {
                    const alternatives = findAlternativeSlots(facultyData, selectedTeacher, selectedCourse, priority);
                    renderAlternativeSlots(alternatives, selectedCourse, selectedTeacher);
                }, 1000);
            });
            
            // Modal event listeners
            closeModalBtn.addEventListener('click', closeModal);
            closeModalBtn2.addEventListener('click', closeModal);
            selectSlotBtn.addEventListener('click', function() {
                alert('Slot selected! This is a demo - in a real application, this would update the schedule.');
                closeModal();
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('slot-details-modal');
                if (event.target === modal) {
                    closeModal();
                }
            });
            
            // Select first teacher by default if available
            if (teachers.length > 0) {
                teacherSelect.value = teachers[0];
                teacherSelect.dispatchEvent(new Event('change'));
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>